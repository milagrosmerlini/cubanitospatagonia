<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cubanitos Patagonia</title>

  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#c97a2b">

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <link rel="icon" href="logo.png">
  <link rel="apple-touch-icon" href="logo.png">
</head>

<body>
  <header class="topbar">
    <div class="header-left">
      <div class="logo">
        <img src="logo.png" alt="Cubanitos Patagonia">
      </div>
    </div>

    <div class="header-center">Cubanitos Patagonia</div>

    <div class="menuWrap">
      <button class="iconBtn" id="menu-btn" aria-label="Abrir menú" aria-expanded="false" type="button">
        <span class="burger"></span>
        <span class="burger"></span>
        <span class="burger"></span>
      </button>

      <div class="menu" id="menu" aria-hidden="true">
        <button class="menuItem" data-go="cobrar" type="button">Cobrar</button>
        <button class="menuItem" data-go="ventas" type="button">Ventas</button>
        <button class="menuItem" data-go="caja" type="button">Caja</button>
        <button class="menuItem" data-go="sesion" type="button">Sesión</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- =========================
         TAB: COBRAR
    ========================== -->
    <section class="panel show" id="tab-cobrar">

      <!-- Canal -->
      <div class="card channelTabs">
        <button class="channelTab active" id="tab-presencial" data-channel="presencial" type="button">Presencial</button>
        <button class="channelTab" id="tab-pedidosya" data-channel="pedidosya" type="button">PedidosYa</button>
      </div>

      <div class="grid">
        <div class="card product" data-sku="cubanito_comun">
          <div class="row">
            <div>
              <h2>Cubanito común</h2>
              <p class="muted">$<span data-price="cubanito_comun"></span></p>
            </div>
            <div class="pill">Unidad</div>
          </div>
          <div class="counter">
            <button class="btn ghost" data-action="dec" type="button">−</button>
            <input class="qty" type="number" inputmode="numeric" min="0" step="1" value="0" data-qty="cubanito_comun" />
            <button class="btn ghost" data-action="inc" type="button">+</button>
          </div>
        </div>

        <div class="card product" data-sku="cubanito_blanco">
          <div class="row">
            <div>
              <h2>Cubanito choco negro</h2>
              <p class="muted">$<span data-price="cubanito_blanco"></span></p>
            </div>
            <div class="pill">Unidad</div>
          </div>
          <div class="counter">
            <button class="btn ghost" data-action="dec" type="button">−</button>
            <input class="qty" type="number" inputmode="numeric" min="0" step="1" value="0" data-qty="cubanito_blanco" />
            <button class="btn ghost" data-action="inc" type="button">+</button>
          </div>
        </div>

        <div class="card product" data-sku="cubanito_negro">
          <div class="row">
            <div>
              <h2>Cubanito choco blanco</h2>
              <p class="muted">$<span data-price="cubanito_negro"></span></p>
            </div>
            <div class="pill">Unidad</div>
          </div>
          <div class="counter">
            <button class="btn ghost" data-action="dec" type="button">−</button>
            <input class="qty" type="number" inputmode="numeric" min="0" step="1" value="0" data-qty="cubanito_negro" />
            <button class="btn ghost" data-action="inc" type="button">+</button>
          </div>
        </div>

        <div class="card product" data-sku="garrapinadas">
          <div class="row">
            <div>
              <h2>Garrapiñadas</h2>
              <p class="muted">$<span data-price="garrapinadas"></span> <span class="muted"></span></p>
              <p class="hint" data-promo="garrapinadas">Promo: 3 por $3000</p>
            </div>
            <div class="pill">Bolsa</div>
          </div>
          <div class="counter">
            <button class="btn ghost" data-action="dec" type="button">−</button>
            <input class="qty" type="number" inputmode="numeric" min="0" step="1" value="0" data-qty="garrapinadas" />
            <button class="btn ghost" data-action="inc" type="button">+</button>
          </div>
        </div>
      </div>

      <div class="card summary">
        <div class="summary-top">
          <div>
            <h2>Total</h2>
            <p class="muted tiny" id="promo-line"></p>
          </div>
          <div class="total" id="total">$0</div>
        </div>

        <div class="splitpay">
          <h3>Pago</h3>

          <div class="payMode">
            <label class="chip">
              <input type="radio" name="paymode" value="cash" checked>
              <span>Efectivo</span>
            </label>

            <label class="chip">
              <input type="radio" name="paymode" value="transfer">
              <span>Transferencia</span>
            </label>

            <label class="chip">
              <input type="radio" name="paymode" value="mixed">
              <span>Mixto</span>
            </label>
          </div>

          <div id="mixed-area" class="hidden">
            <div class="split-grid">
              <label class="field">
                <span>Efectivo</span>
                <input id="cash" type="number" inputmode="numeric" min="0" step="100" placeholder="0" />
              </label>

              <label class="field">
                <span>Transferencia</span>
                <input id="transfer" type="number" inputmode="numeric" min="0" step="100" placeholder="0" />
              </label>

              <div class="field readonly">
                <span>Falta / Sobra</span>
                <div id="diff" class="diff">—</div>
              </div>
            </div>
          </div>

          <div class="actions">
            <button class="btn" id="btn-save" type="button">Guardar venta</button>
            <button class="btn ghost" id="btn-clear" type="button">Limpiar</button>
          </div>

          <p class="tiny muted" id="save-msg"></p>
          <p class="tiny muted lockedNote" id="edit-note" style="display:none;">
            Estás en modo solo lectura. Iniciá sesión como admin para guardar ventas.
          </p>
        </div>
      </div>
    </section>

    <!-- =========================
         TAB: VENTAS
    ========================== -->
    <section class="panel" id="tab-ventas">
      <div class="card">
        <div class="row space">
          <div>
            <h2>Ventas de hoy</h2>
            <p class="muted tiny" id="today-meta">—</p>
          </div>

          <div class="row space">
            <button class="btn ghost" id="btn-undo" type="button" title="Borra la última venta guardada de hoy">
              Deshacer última
            </button>
            <button class="btn danger ghost" id="btn-reset-day" type="button" title="Borra todas las ventas guardadas de hoy">
              Reiniciar día
            </button>
          </div>
        </div>

        <div class="kpis kpis-compact">
          <div class="kpi">
            <div class="kpi-title">Total del día</div>
            <div class="kpi-value" id="today-total">$0</div>
          </div>
          <div class="kpi">
            <div class="kpi-title">Ventas</div>
            <div class="kpi-value" id="today-count">0</div>
          </div>
        </div>

        <div id="sales-list" class="sales"></div>
      </div>

      <div class="card" style="margin-top:12px;">
        <div class="row space">
          <h2>Historial de ventas</h2>
          <p class="muted tiny">Entrá a una fecha para ver resumen y balance.</p>
        </div>

        <div id="history-list" class="historyList"></div>

        <div id="history-detail" class="historyDetail hidden">
          <div class="row space">
            <div>
              <h2 id="history-title">Fecha</h2>
              <p class="muted tiny">Resumen + balance del día</p>
            </div>
            <button class="btn ghost" id="btn-history-back" type="button">Volver</button>
          </div>

          <div class="kpis" style="margin-top:12px;">
            <div class="kpi">
              <div class="kpi-title">Total</div>
              <div class="kpi-value" id="hist-total">$0</div>
            </div>
            <div class="kpi">
              <div class="kpi-title">Efectivo</div>
              <div class="kpi-value" id="hist-cash">$0</div>
            </div>
            <div class="kpi">
              <div class="kpi-title">Transferencia</div>
              <div class="kpi-value" id="hist-transfer">$0</div>
            </div>
          </div>

          <div class="divider"></div>

          <h3>Balance (cantidades)</h3>
          <div class="counts" id="hist-counts"></div>

          <div class="divider"></div>

          <h3>Ventas del día</h3>
          <div id="hist-sales" class="sales"></div>
        </div>
      </div>
    </section>

    <!-- =========================
         TAB: CAJA
    ========================== -->
    <section class="panel" id="tab-caja">
      <div class="grid two">
        <div class="card">
          <h2>Caja de hoy</h2>

          <div class="kpis">
            <div class="kpi">
              <div class="kpi-title">Total vendido</div>
              <div class="kpi-value" id="kpi-total">$0</div>
            </div>
            <div class="kpi">
              <div class="kpi-title">Efectivo</div>
              <div class="kpi-value" id="kpi-cash">$0</div>
            </div>
            <div class="kpi">
              <div class="kpi-title">Transferencia</div>
              <div class="kpi-value" id="kpi-transfer">$0</div>
            </div>
          </div>

          <div class="divider"></div>

          <h3>Comparar efectivo (opcional)</h3>
          <p class="muted tiny">Contá la plata real y compará con lo esperado.</p>

          <label class="field">
            <span>Efectivo real contado</span>
            <input id="cash-real" type="number" inputmode="numeric" min="0" step="100" placeholder="0" />
          </label>

          <div class="field readonly">
            <span>Diferencia (real − esperado)</span>
            <div id="cash-delta" class="diff">—</div>
          </div>
        </div>

        <div class="card">
          <h2>Cantidades vendidas</h2>
          <div class="counts" id="counts"></div>

          <div class="divider"></div>

          <button class="btn ghost" id="btn-export" type="button">Exportar CSV (hoy)</button>
          <p class="tiny muted">CSV sirve para abrir en Excel/Sheets.</p>
        </div>
      </div>
    </section>

    <!-- =========================
         TAB: SESIÓN
    ========================== -->
    <section class="panel" id="tab-sesion">
      <div class="card authCard">
        <div class="row space">
          <div>
            <h2>Sesión</h2>
            <p class="muted tiny">Si no sos admin igual podés ver todo, pero no editar.</p>
          </div>
          <span class="badge" id="auth-status-badge">Invitado</span>
        </div>

        <div class="divider"></div>

        <div class="authGrid">
          <label class="field">
            <span>Código de acceso</span>
            <input id="auth-code" type="password" placeholder="Ingresá el código" />
          </label>

          <div class="actions">
            <button class="btn" id="btn-login-code" type="button">Entrar con código</button>
            <button class="btn ghost" id="btn-login" type="button">Entrar con email</button>
            <button class="btn danger ghost" id="btn-logout" type="button">Salir</button>
          </div>

          <div id="email-area" class="hidden">
            <div class="divider"></div>

            <label class="field">
              <span>Email</span>
              <input id="auth-email" type="email" placeholder="caja@..." />
            </label>

            <label class="field">
              <span>Contraseña</span>
              <input id="auth-pass" type="password" placeholder="••••••••" />
            </label>
          </div>

          <p class="tiny muted" id="auth-msg"></p>
          <p class="tiny muted" id="auth-user"></p>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer muted tiny">
    Guardado en la nube (Supabase).
  </footer>

  <script>
    window.SUPABASE_URL = "https://sxrkcbjtdeirgxldvrvi.supabase.co";
    window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN4cmtjYmp0ZGVpcmd4bGR2cnZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4OTE0MDUsImV4cCI6MjA4NTQ2NzQwNX0.IY2ww5XqNEMwlGhe_3Vdp-KuF4-h_of-k-CeYMPuGCQ";
    window.supabase = supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./sw.js").catch(console.error);
      });
    }
  </script>
  <script src="app.js"></script>
</body>
</html>